# For most projects, this workflow file will not need changing; you simply need
# to commit it to your repository.
#
# You may wish to alter this file to override the set of languages analyzed,
# or to provide custom queries or build logic.
#
# ******** NOTE ********
# We have attempted to detect the languages in your repository. Please check
# the `language` matrix defined below to confirm you have the correct set of
# supported CodeQL languages.
#

# CodeQL 流水线
name: "CodeQL"

# 触发条件
on:
  # 主分支推送
  push:
    branches: [ "master" ]
  # 主分支拉取请求
  pull_request:
    branches: [ "master" ]
  # 定时调度
  schedule:
  - cron: '0 3 * * 6'

# 任务列表
jobs:
  # 代码分析
  analyze:
    name: Analyze
    # 运行系统
    runs-on: ubuntu-latest
    # 权限
    permissions:
      actions: read
      contents: read
      security-events: write

    # 策略
    strategy:
      fail-fast: false
      matrix:
        # java 语言
        language: [ 'java' ]

    # 步骤
    steps:
    # 1. 检出代码
    - name: Checkout repository
      uses: actions/checkout@v3

    # 2. 初始化 CodeQL
    - name: Initialize CodeQL
      uses: github/codeql-action/init@v2
      with:
        languages: ${{ matrix.language }}

    # 3. 自定义步骤

    # 4. 自动构建
    - name: Auto build
      uses: github/codeql-action/autobuild@v2
      # 自定义命令行
      run: |
        echo "Run, Build Application using script"
        ./location_of_script_within_repo/buildscript.sh

    # 5. 语法分析
    - name: Perform CodeQL Analysis
      uses: github/codeql-action/analyze@v2
